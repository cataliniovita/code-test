"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[6509],{46509:(b,p,a)=>{a.r(p),a.d(p,{DfSchedulerDetailsComponent:()=>O});var m,o=a(97582),s=a(56223),c=a(62651),g=a(35326),d=a(86806),T=a(42346),h=a(96814),f=a(74104),E=a(2032),l=a(98525),_=a(82599),i=a(32296),v=a(41609),D=a(75058),y=a(78791),Z=a(41089),C=a(26306),A=a(58504),e=a(65879),P=a(81896),I=a(65763),M=a(64170),S=a(23680);function L(n,r){if(1&n&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function U(n,r){if(1&n&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function B(n,r){if(1&n&&(e.TgZ(0,"mat-form-field",23)(1,"mat-label"),e._uU(2),e.ALo(3,"transloco"),e.qZA(),e.TgZ(4,"mat-select",24),e.YNc(5,U,2,2,"mat-option",10),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,2,"scheduler.form.label.component")),e.xp6(3),e.Q6J("ngForOf",t.componentDropdownOptions)}}function x(n,r){1&n&&(e.ynx(0),e.TgZ(1,"mat-form-field",4)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e._UZ(5,"textarea",25),e.qZA(),e.BQk()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"scheduler.form.label.payload")))}a(6625);const R=function(n){return{label:n}};let O=((m=class{constructor(r,t,u,K,G,W){this.service=r,this.formBuilder=t,this.activatedRoute=u,this.router=K,this.accessListService=G,this.themeService=W,this.relatedParam="task_log_by_task_id",this.componentDropdownOptions=[],this.log="",this.alertMsg="",this.showAlert=!1,this.alertType="error",this.isDarkMode=this.themeService.darkMode$}ngOnInit(){this.formGroup=this.formBuilder.group({name:["",s.kI.required],description:[""],active:[!0,s.kI.required],serviceId:["",s.kI.required],component:["",s.kI.required],method:["GET",s.kI.required],frequency:[]}),this.activatedRoute.data.subscribe(r=>{this.userServicesDropdownOptions=r.data.resource}),this.activatedRoute.data.subscribe(r=>{this.scheduleToEdit=r.schedulerObject,this.scheduleToEdit&&(this.log=this.scheduleToEdit.taskLogByTaskId?.content??"",this.getServiceAccessList(this.scheduleToEdit.serviceId),this.formGroup.setValue({name:this.scheduleToEdit.name,description:this.scheduleToEdit.description,active:this.scheduleToEdit.isActive,serviceId:this.scheduleToEdit.serviceId,component:this.scheduleToEdit.component,method:this.scheduleToEdit.verb,frequency:this.scheduleToEdit.frequency}),"GET"!==this.scheduleToEdit.verb&&this.addPayloadField(this.scheduleToEdit.payload))}),this.formGroup.get("method")?.valueChanges.subscribe(r=>{"GET"===r?this.removePayloadField():this.formGroup.contains("payload")||this.addPayloadField()}),this.formGroup.get("serviceId")?.valueChanges.subscribe(r=>{this.getServiceAccessList(r)})}triggerAlert(r,t){this.alertType=r,this.alertMsg=t,this.showAlert=!0}onCancel(){this.router.navigate([c.Z.SYSTEM_SETTINGS,c.Z.SCHEDULER])}onSubmit(){if(!this.formGroup.invalid&&!this.formGroup.pristine)if(typeof this.scheduleToEdit>"u"){const r=this.assemblePayload();this.service.create({resource:[r]},{snackbarSuccess:"scheduler.alerts.createdSuccess",fields:"*",related:this.relatedParam}).pipe((0,C.K)(t=>(this.triggerAlert("error",t.error.error.context.resource[0].message),(0,A._)(()=>new Error(t))))).subscribe(()=>this.router.navigate([c.Z.SYSTEM_SETTINGS,c.Z.SCHEDULER]))}else if(this.scheduleToEdit){const r=this.assemblePayload();this.service.update(this.scheduleToEdit.id,r,{snackbarSuccess:"scheduler.alerts.updateSuccess",fields:"*",related:this.relatedParam}).pipe((0,C.K)(t=>(this.triggerAlert("error",t.error.error.message),(0,A._)(()=>new Error(t))))).subscribe(()=>this.router.navigate([c.Z.SYSTEM_SETTINGS,c.Z.SCHEDULER]))}}addPayloadField(r){this.formGroup.addControl("payload",this.formBuilder.control(r??"",[g.U]))}removePayloadField(){this.formGroup.removeControl("payload")}getServiceAccessList(r){const t=this.userServicesDropdownOptions.find(u=>u.id===r);this.selectedService=t,t&&this.accessListService.get(t.name,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(u=>{this.componentDropdownOptions=u.resource})}getVerbMask(r){switch(r){case"GET":default:return 1;case"POST":return 2;case"PUT":return 4;case"PATCH":return 8;case"DELETE":return 16}}assemblePayload(){if(this.selectedService){const r={component:this.formGroup.value.component,description:this.formGroup.value.description,frequency:this.formGroup.value.frequency,isActive:this.formGroup.value.active,name:this.formGroup.value.name,payload:this.formGroup.value.payload??null,serviceId:this.formGroup.value.serviceId,serviceName:this.selectedService.name,verb:this.formGroup.value.method,service:{id:this.formGroup.value.serviceId,name:this.selectedService.name,label:this.selectedService.label,description:this.selectedService.description,type:this.selectedService.type,components:this.componentDropdownOptions},verbMask:this.getVerbMask(this.formGroup.value.method)};return this.scheduleToEdit?{lastModifiedDate:this.scheduleToEdit.lastModifiedDate,lastModifiedById:this.scheduleToEdit.lastModifiedById,hasLog:!!this.scheduleToEdit.taskLogByTaskId,createdDate:this.scheduleToEdit.createdDate,createdById:this.scheduleToEdit.createdById,id:this.scheduleToEdit.id,...r}:{...r,id:null}}return null}}).\u0275fac=function(r){return new(r||m)(e.Y36(d.bi),e.Y36(s.qu),e.Y36(P.gz),e.Y36(P.F0),e.Y36(d.PA),e.Y36(I.F))},m.\u0275cmp=e.Xpm({type:m,selectors:[["df-scheduler"]],standalone:!0,features:[e.jDz],decls:54,vars:49,consts:[[3,"showAlert","alertType","alertClosed"],["dynamicHeight","","mat-stretch-tabs","false","mat-align-tabs","start"],["label","Basic"],[1,"details-section",3,"formGroup","ngSubmit"],["appearance","outline","subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","placeholder","Name","formControlName","name"],["color","primary","formControlName","active",1,"dynamic-width"],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["rows","1","matInput","","placeholder","Description","formControlName","description"],["formControlName","serviceId"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic","class","dynamic-width",4,"ngIf"],["matInput","","type","number","formControlName","frequency"],[4,"ngIf"],["formControlName","method",1,"dynamic-width",3,"schema"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",1,"cancel-btn",3,"click"],["mat-flat-button","",1,"save-btn"],["label","Log"],[1,"details-section"],[1,"full-width",3,"readonly","value"],["type","button","mat-flat-button","",1,"schema","cancel-btn",3,"click"],[3,"value"],["subscriptSizing","dynamic",1,"dynamic-width"],["formControlName","component"],["rows","1","matInput","","formControlName","payload"]],template:function(r,t){1&r&&(e.TgZ(0,"div"),e.ALo(1,"async"),e.TgZ(2,"df-alert",0),e.NdJ("alertClosed",function(){return t.showAlert=!1}),e._uU(3),e.qZA(),e.TgZ(4,"mat-tab-group",1)(5,"mat-tab",2)(6,"h4"),e._uU(7),e.ALo(8,"transloco"),e.qZA(),e.TgZ(9,"form",3),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(10,"mat-form-field",4)(11,"mat-label"),e._uU(12),e.ALo(13,"transloco"),e.qZA(),e._UZ(14,"input",5),e.qZA(),e.TgZ(15,"mat-slide-toggle",6),e._uU(16),e.ALo(17,"transloco"),e.qZA(),e.TgZ(18,"mat-form-field",7)(19,"mat-label"),e._uU(20),e.ALo(21,"transloco"),e.qZA(),e._UZ(22,"textarea",8),e.qZA(),e.TgZ(23,"mat-form-field",4)(24,"mat-label"),e._uU(25),e.ALo(26,"transloco"),e.qZA(),e.TgZ(27,"mat-select",9),e.YNc(28,L,2,2,"mat-option",10),e.qZA()(),e.YNc(29,B,6,4,"mat-form-field",11),e.TgZ(30,"mat-form-field",4)(31,"mat-label"),e._uU(32),e.ALo(33,"transloco"),e.qZA(),e._UZ(34,"input",12),e.qZA(),e.YNc(35,x,6,3,"ng-container",13),e._UZ(36,"df-verb-picker",14),e.ALo(37,"transloco"),e.TgZ(38,"div",15)(39,"button",16),e.NdJ("click",function(){return t.onCancel()}),e._uU(40),e.ALo(41,"transloco"),e.qZA(),e.TgZ(42,"button",17),e._uU(43),e.ALo(44,"transloco"),e.qZA()()()(),e.TgZ(45,"mat-tab",18)(46,"div",19)(47,"p"),e._uU(48),e.ALo(49,"transloco"),e.qZA(),e._UZ(50,"df-ace-editor",20),e.TgZ(51,"button",21),e.NdJ("click",function(){return t.onCancel()}),e._uU(52),e.ALo(53,"transloco"),e.qZA()()()()()),2&r&&(e.Tol(e.lcZ(1,23,t.isDarkMode)?"dark-theme":""),e.xp6(2),e.Q6J("showAlert",t.showAlert)("alertType",t.alertType),e.xp6(1),e.hij(" ",t.alertMsg," "),e.xp6(4),e.Oqu(e.lcZ(8,25,"scheduler.taskOverviewSubtitle")),e.xp6(2),e.Q6J("formGroup",t.formGroup),e.xp6(3),e.Oqu(e.lcZ(13,27,"scheduler.form.label.name")),e.xp6(4),e.Oqu(e.lcZ(17,29,"scheduler.form.label.active")),e.xp6(4),e.Oqu(e.lcZ(21,31,"scheduler.form.label.description")),e.xp6(5),e.Oqu(e.lcZ(26,33,"scheduler.form.label.service")),e.xp6(3),e.Q6J("ngForOf",t.userServicesDropdownOptions),e.xp6(1),e.Q6J("ngIf",t.componentDropdownOptions.length),e.xp6(3),e.Oqu(e.lcZ(33,35,"scheduler.form.label.frequency")),e.xp6(3),e.Q6J("ngIf",t.formGroup.controls.payload),e.xp6(1),e.Q6J("schema",e.VKq(47,R,e.lcZ(37,37,"scheduler.form.label.method"))),e.xp6(4),e.hij(" ",e.lcZ(41,39,"cancel")," "),e.xp6(3),e.hij(" ",e.lcZ(44,41,"save")," "),e.xp6(5),e.AsE(" ",e.lcZ(49,43,"scheduler.logs.statusCode"),": ",null==t.scheduleToEdit||null==t.scheduleToEdit.taskLogByTaskId?null:t.scheduleToEdit.taskLogByTaskId.statusCode," "),e.xp6(2),e.Q6J("readonly",!0)("value",t.log),e.xp6(2),e.hij(" ",e.lcZ(53,45,"goBack")," "))},dependencies:[h.Ov,i.ot,i.lW,E.c,E.Nt,M.KE,M.hX,f.Nh,f.uX,f.SP,l.LD,l.gD,S.ey,_.rP,_.Rr,h.O5,h.ax,T.Ot,s.UX,s._Y,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,v.C,D.M,Z.v],encapsulation:2}),m);O=(0,o.gn)([(0,y.c)({checkProperties:!0})],O)},41089:(b,p,a)=>{a.d(p,{v:()=>E});var o=a(65879),s=a(96814),c=a(32296),g=a(45597),d=a(90590);function T(l,_){if(1&l){const i=o.EpF();o.TgZ(0,"button",5),o.NdJ("click",function(){o.CHM(i);const D=o.oxw(2);return o.KtG(D.dismissAlert())}),o.TgZ(1,"fa-icon",6),o._uU(2),o.qZA()()}if(2&l){const i=o.oxw(2);o.xp6(1),o.Q6J("icon",i.faXmark),o.xp6(1),o.Oqu("alerts.close")}}function h(l,_){if(1&l&&(o.TgZ(0,"div",1),o._UZ(1,"fa-icon",2),o.TgZ(2,"span",3),o.Hsn(3),o.qZA(),o.YNc(4,T,3,2,"button",4),o.qZA()),2&l){const i=o.oxw();o.Tol(i.alertType),o.xp6(1),o.Q6J("icon",i.icon),o.xp6(3),o.Q6J("ngIf",i.dismissible)}}const f=["*"];let E=(()=>{class l{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new o.vpe,this.faXmark=d.g82}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return d.f8k;case"error":return d.$9F;case"warning":return d.RLE;default:return d.sqG}}}return l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=o.Xpm({type:l,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[o.jDz],ngContentSelectors:f,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(i,v){1&i&&(o.F$t(),o.YNc(0,h,5,4,"div",0)),2&i&&o.Q6J("ngIf",v.showAlert)},dependencies:[s.O5,c.ot,c.RK,g.uH,g.BN],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]}),l})()}}]);