"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[3517],{73517:(E,f,r)=>{r.r(f),r.d(f,{DfLimitDetailsComponent:()=>D});var d,o=r(97582),n=r(56223),u=r(26306),p=r(58504),c=r(32296),h=r(82599),v=r(23680),_=r(96814),T=r(98525),a=r(2032),m=r(64170),l=r(41089),g=r(86806),A=r(42346),O=r(75058),y=r(78791),t=r(65879),C=r(81896),I=r(65763),P=r(72246);function M(s,e){if(1&s&&(t.TgZ(0,"mat-option",32),t._uU(1),t.qZA()),2&s){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.hij("",i.name," ")}}function L(s,e){if(1&s&&(t.ynx(0),t.TgZ(1,"mat-form-field",2)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-select",30),t.YNc(6,M,2,2,"mat-option",31),t.qZA()(),t.BQk()),2&s){const i=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,2,"limits.service")),t.xp6(3),t.Q6J("ngForOf",i.serviceDropdownOptions)}}function b(s,e){if(1&s&&(t.TgZ(0,"mat-option",32),t._uU(1),t.qZA()),2&s){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.hij("",i.name," ")}}function x(s,e){if(1&s&&(t.ynx(0),t.TgZ(1,"mat-form-field",2)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-select",33),t.YNc(6,b,2,2,"mat-option",31),t.qZA()(),t.BQk()),2&s){const i=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,2,"limits.role")),t.xp6(3),t.Q6J("ngForOf",i.roleDropdownOptions)}}function U(s,e){if(1&s&&(t.TgZ(0,"mat-option",32),t._uU(1),t.qZA()),2&s){const i=e.$implicit;t.Q6J("value",i.id),t.xp6(1),t.hij("",i.name," ")}}function B(s,e){if(1&s&&(t.ynx(0),t.TgZ(1,"mat-form-field",2)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-select",34),t.YNc(6,U,2,2,"mat-option",31),t.qZA()(),t.BQk()),2&s){const i=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,2,"limits.user")),t.xp6(3),t.Q6J("ngForOf",i.userDropdownOptions)}}function G(s,e){1&s&&(t.ynx(0),t.TgZ(1,"mat-form-field",2)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t._UZ(5,"input",35),t.qZA(),t.BQk()),2&s&&(t.xp6(3),t.Oqu(t.lcZ(4,1,"limits.endpoint")))}r(6625);const R=function(s,e){return{label:s,description:e}};let D=((d=class{constructor(e,i,Z,q,F,k,K){this.limitService=e,this.router=i,this.activatedRoute=Z,this.translateService=q,this.formBuilder=F,this.themeService=k,this.snackbarService=K,this.isEditMode=!1,this.limitTypeToEdit=null,this.roleDropdownOptions=[],this.userDropdownOptions=[],this.serviceDropdownOptions=[],this.alertMsg="",this.showAlert=!1,this.alertType="error",this.type="create",this.isDarkMode=this.themeService.darkMode$,this.formGroup=this.formBuilder.group({limitName:["",n.kI.required],description:[""],limitType:["instance",n.kI.required],serviceId:[],roleId:[],userId:[],endpoint:[],limitRate:[null,n.kI.required],limitPeriod:["minute",n.kI.required],verb:[],active:[!0]})}ngOnInit(){this.activatedRoute.data.subscribe(e=>{this.type=e.type,"edit"===e.type&&(this.limitTypeToEdit=e.data,this.snackbarService.setSnackbarLastEle(this.limitTypeToEdit.name,!0),this.formGroup.patchValue({limitName:this.limitTypeToEdit.name,limitType:this.limitTypeToEdit.type,serviceId:this.limitTypeToEdit.serviceId,roleId:this.limitTypeToEdit.roleId,userId:this.limitTypeToEdit.userId,limitRate:this.limitTypeToEdit.rate,limitPeriod:this.limitTypeToEdit.period,active:this.limitTypeToEdit.isActive,description:this.limitTypeToEdit.description,endpoint:this.limitTypeToEdit.endpoint,verb:this.limitTypeToEdit.verb}),this.formGroup.value.serviceId||this.removeFormField("serviceId"),this.formGroup.value.roleId||this.removeFormField("roleId"),this.formGroup.value.userId||this.removeFormField("userId"),this.formGroup.value.endpoint||this.removeFormField("endpoint"))}),"create"===this.type&&(this.removeFormField(),this.renderCorrectHiddenFields("instance")),this.activatedRoute.data.subscribe(e=>{this.serviceDropdownOptions=e.services.resource}),this.activatedRoute.data.subscribe(e=>{this.userDropdownOptions=e.users.resource}),this.activatedRoute.data.subscribe(e=>{this.roleDropdownOptions=e.roles.resource}),this.formGroup.get("limitType")?.valueChanges.subscribe(e=>{e&&(this.removeFormField(),this.renderCorrectHiddenFields(e))})}onSubmit(){if(this.formGroup.valid){if(this.showAlert=!1,"create"===this.type){const e=this.assembleLimitPayload();this.limitService.create({resource:[e]}).pipe((0,u.K)(i=>(this.alertMsg=i.error.error.message,this.showAlert=!0,(0,p._)(()=>new Error(i))))).subscribe(i=>{this.router.navigate(["../",i.resource[0].id],{relativeTo:this.activatedRoute})})}else if("edit"===this.type){const e=this.assembleLimitPayload();this.limitService.update(e.id,e).pipe((0,u.K)(i=>(this.alertMsg=i.error.error.message,this.showAlert=!0,(0,p._)(()=>new Error(i))))).subscribe(i=>{this.router.navigate(["../",i.id],{relativeTo:this.activatedRoute})})}}else this.alertMsg=this.translateService.translate("limits.invalidForm"),this.showAlert=!0}onCancel(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}assembleLimitPayload(){const e={description:this.formGroup.value.description??null,endpoint:this.formGroup.value.endpoint??null,isActive:this.formGroup.value.active,name:this.formGroup.value.limitName,period:this.formGroup.value.limitPeriod,roleId:this.formGroup.value.roleId??null,serviceId:this.formGroup.value.serviceId??null,userId:this.formGroup.value.userId??null,type:this.formGroup.value.limitType,verb:this.formGroup.value.verb};return"edit"===this.type?{id:this.limitTypeToEdit?.id,createdDate:this.limitTypeToEdit?.createdDate,lastModifiedDate:this.limitTypeToEdit?.lastModifiedDate,rate:this.formGroup.value.limitRate??null,...e}:{cacheData:{},rate:this.formGroup.value.limitRate?this.formGroup.value.limitRate.toString():"1",...e}}renderCorrectHiddenFields(e){switch(e){case"instance":case"instance.each_user":break;case"instance.user.service":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.kI.required])),this.formGroup.addControl("userId",this.formBuilder.control("",[n.kI.required]));break;case"instance.each_user.service":case"instance.service":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.kI.required]));break;case"instance.role":this.formGroup.addControl("roleId",this.formBuilder.control("",[n.kI.required]));break;case"instance.user":this.formGroup.addControl("userId",this.formBuilder.control("",[n.kI.required]));break;case"instance.user.service.endpoint":this.formGroup.addControl("userId",this.formBuilder.control("",[n.kI.required])),this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.kI.required])),this.formGroup.addControl("endpoint",this.formBuilder.control("",[n.kI.required]));break;case"instance.service.endpoint":case"instance.each_user.service.endpoint":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.kI.required])),this.formGroup.addControl("endpoint",this.formBuilder.control("",[n.kI.required]));break;default:this.removeFormField()}}removeFormField(e){e?this.formGroup.removeControl(e):(this.formGroup.removeControl("serviceId"),this.formGroup.removeControl("roleId"),this.formGroup.removeControl("userId"),this.formGroup.removeControl("endpoint"))}}).\u0275fac=function(e){return new(e||d)(t.Y36(g.xQ),t.Y36(C.F0),t.Y36(C.gz),t.Y36(A.Vn),t.Y36(n.qu),t.Y36(I.F),t.Y36(P.w))},d.\u0275cmp=t.Xpm({type:d,selectors:[["df-limit"]],standalone:!0,features:[t.jDz],decls:92,vars:89,consts:[[3,"showAlert","alertType","alertClosed"],[1,"details-section",3,"formGroup","ngSubmit"],["appearance","outline","subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","type","text","formControlName","limitName"],["formControlName","verb",1,"dynamic-width",3,"schema"],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["rows","1","matInput","","type","text","formControlName","description"],["formControlName","limitType"],["value","instance"],["value","instance.user"],["value","instance.each_user"],["value","instance.service"],["value","instance.role"],["value","instance.user.service"],["value","instance.each_user.service"],["value","instance.service.endpoint"],["value","instance.user.service.endpoint"],["value","instance.each_user.service.endpoint"],[4,"ngIf"],["matInput","","type","number","formControlName","limitRate"],["formControlName","limitPeriod"],["value","minute"],["value","hour"],["value","day"],["value","7-day"],["value","30-day"],["color","primary","formControlName","active",1,"full-width"],[1,"full-width","action-bar"],["type","button","mat-flat-button","",1,"cancel-btn",3,"click"],["mat-flat-button","","color","primary",1,"save-btn"],["formControlName","serviceId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","roleId"],["formControlName","userId"],["matInput","","type","text","formControlName","endpoint"]],template:function(e,i){1&e&&(t.TgZ(0,"df-alert",0),t.NdJ("alertClosed",function(){return i.showAlert=!1}),t._uU(1),t.qZA(),t.TgZ(2,"form",1),t.NdJ("ngSubmit",function(){return i.onSubmit()}),t.ALo(3,"async"),t.TgZ(4,"mat-form-field",2)(5,"mat-label"),t._uU(6),t.ALo(7,"transloco"),t.qZA(),t._UZ(8,"input",3),t.qZA(),t._UZ(9,"df-verb-picker",4),t.ALo(10,"transloco"),t.ALo(11,"transloco"),t.TgZ(12,"mat-form-field",5)(13,"mat-label"),t._uU(14),t.ALo(15,"transloco"),t.qZA(),t._UZ(16,"textarea",6),t.qZA(),t.TgZ(17,"mat-form-field",2)(18,"mat-label"),t._uU(19),t.ALo(20,"transloco"),t.qZA(),t.TgZ(21,"mat-select",7)(22,"mat-option",8),t._uU(23),t.ALo(24,"transloco"),t.qZA(),t.TgZ(25,"mat-option",9),t._uU(26),t.ALo(27,"transloco"),t.qZA(),t.TgZ(28,"mat-option",10),t._uU(29),t.ALo(30,"transloco"),t.qZA(),t.TgZ(31,"mat-option",11),t._uU(32),t.ALo(33,"transloco"),t.qZA(),t.TgZ(34,"mat-option",12),t._uU(35),t.ALo(36,"transloco"),t.qZA(),t.TgZ(37,"mat-option",13),t._uU(38),t.ALo(39,"transloco"),t.qZA(),t.TgZ(40,"mat-option",14),t._uU(41),t.ALo(42,"transloco"),t.qZA(),t.TgZ(43,"mat-option",15),t._uU(44),t.ALo(45,"transloco"),t.qZA(),t.TgZ(46,"mat-option",16),t._uU(47),t.ALo(48,"transloco"),t.qZA(),t.TgZ(49,"mat-option",17),t._uU(50),t.ALo(51,"transloco"),t.qZA()()(),t.YNc(52,L,7,4,"ng-container",18),t.YNc(53,x,7,4,"ng-container",18),t.YNc(54,B,7,4,"ng-container",18),t.YNc(55,G,6,3,"ng-container",18),t.TgZ(56,"mat-form-field",2)(57,"mat-label"),t._uU(58),t.ALo(59,"transloco"),t.qZA(),t._UZ(60,"input",19),t.qZA(),t.TgZ(61,"mat-form-field",2)(62,"mat-label"),t._uU(63),t.ALo(64,"transloco"),t.qZA(),t.TgZ(65,"mat-select",20)(66,"mat-option",21),t._uU(67),t.ALo(68,"transloco"),t.qZA(),t.TgZ(69,"mat-option",22),t._uU(70),t.ALo(71,"transloco"),t.qZA(),t.TgZ(72,"mat-option",23),t._uU(73),t.ALo(74,"transloco"),t.qZA(),t.TgZ(75,"mat-option",24),t._uU(76),t.ALo(77,"transloco"),t.qZA(),t.TgZ(78,"mat-option",25),t._uU(79),t.ALo(80,"transloco"),t.qZA()()(),t.ynx(81),t.TgZ(82,"mat-slide-toggle",26),t._uU(83),t.ALo(84,"transloco"),t.qZA(),t.BQk(),t.TgZ(85,"div",27)(86,"button",28),t.NdJ("click",function(){return i.onCancel()}),t._uU(87),t.ALo(88,"transloco"),t.qZA(),t.TgZ(89,"button",29),t._uU(90),t.ALo(91,"transloco"),t.qZA()()()),2&e&&(t.Q6J("showAlert",i.showAlert)("alertType",i.alertType),t.xp6(1),t.Oqu(i.alertMsg),t.xp6(1),t.Tol(t.lcZ(3,34,i.isDarkMode)?"dark-theme":""),t.Q6J("formGroup",i.formGroup),t.xp6(4),t.Oqu(t.lcZ(7,36,"limits.name")),t.xp6(3),t.Q6J("schema",t.WLB(86,R,t.lcZ(10,38,"limits.verb"),t.lcZ(11,40,"limits.verbTooltip"))),t.xp6(5),t.Oqu(t.lcZ(15,42,"limits.description")),t.xp6(5),t.Oqu(t.lcZ(20,44,"limits.limitType")),t.xp6(4),t.hij("",t.lcZ(24,46,"limits.limitTypes.instance")," "),t.xp6(3),t.hij("",t.lcZ(27,48,"limits.limitTypes.user")," "),t.xp6(3),t.hij("",t.lcZ(30,50,"limits.limitTypes.eachUser")," "),t.xp6(3),t.hij("",t.lcZ(33,52,"limits.limitTypes.service")," "),t.xp6(3),t.hij("",t.lcZ(36,54,"limits.limitTypes.role")," "),t.xp6(3),t.hij("",t.lcZ(39,56,"limits.limitTypes.serviceByUser")," "),t.xp6(3),t.hij("",t.lcZ(42,58,"limits.limitTypes.serviceByEachUser")," "),t.xp6(3),t.hij("",t.lcZ(45,60,"limits.limitTypes.endpoint")," "),t.xp6(3),t.hij("",t.lcZ(48,62,"limits.limitTypes.endpointByUser")," "),t.xp6(3),t.hij("",t.lcZ(51,64,"limits.limitTypes.endpointByEachUser")," "),t.xp6(2),t.Q6J("ngIf",i.formGroup.controls.serviceId),t.xp6(1),t.Q6J("ngIf",i.formGroup.controls.roleId),t.xp6(1),t.Q6J("ngIf",i.formGroup.controls.userId),t.xp6(1),t.Q6J("ngIf",i.formGroup.controls.endpoint),t.xp6(3),t.Oqu(t.lcZ(59,66,"limits.limitRate")),t.xp6(5),t.Oqu(t.lcZ(64,68,"limits.limitPeriod")),t.xp6(4),t.hij("",t.lcZ(68,70,"limits.limitPeriods.minute")," "),t.xp6(3),t.hij("",t.lcZ(71,72,"limits.limitPeriods.hour")," "),t.xp6(3),t.hij("",t.lcZ(74,74,"limits.limitPeriods.day")," "),t.xp6(3),t.hij("",t.lcZ(77,76,"limits.limitPeriods.week")," "),t.xp6(3),t.hij("",t.lcZ(80,78,"limits.limitPeriods.30Days")," "),t.xp6(4),t.Oqu(t.lcZ(84,80,"limits.active")),t.xp6(4),t.hij(" ",t.lcZ(88,82,"cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(91,84,"save")," "))},dependencies:[l.v,n.UX,n._Y,n.Fj,n.wV,n.JJ,n.JL,n.sg,n.u,m.lN,m.KE,m.hX,a.c,a.Nt,T.LD,T.gD,v.ey,_.ax,v.Ng,_.O5,h.rP,h.Rr,c.ot,c.lW,A.Ot,O.M,_.Ov],styles:[".df-limit-form-container[_ngcontent-%COMP%]{display:flex;height:100%;width:100%}"]}),d);D=(0,o.gn)([(0,y.c)({checkProperties:!0})],D)},41089:(E,f,r)=>{r.d(f,{v:()=>T});var o=r(65879),n=r(96814),u=r(32296),p=r(45597),c=r(90590);function h(a,m){if(1&a){const l=o.EpF();o.TgZ(0,"button",5),o.NdJ("click",function(){o.CHM(l);const A=o.oxw(2);return o.KtG(A.dismissAlert())}),o.TgZ(1,"fa-icon",6),o._uU(2),o.qZA()()}if(2&a){const l=o.oxw(2);o.xp6(1),o.Q6J("icon",l.faXmark),o.xp6(1),o.Oqu("alerts.close")}}function v(a,m){if(1&a&&(o.TgZ(0,"div",1),o._UZ(1,"fa-icon",2),o.TgZ(2,"span",3),o.Hsn(3),o.qZA(),o.YNc(4,h,3,2,"button",4),o.qZA()),2&a){const l=o.oxw();o.Tol(l.alertType),o.xp6(1),o.Q6J("icon",l.icon),o.xp6(3),o.Q6J("ngIf",l.dismissible)}}const _=["*"];let T=(()=>{class a{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new o.vpe,this.faXmark=c.g82}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return c.f8k;case"error":return c.$9F;case"warning":return c.RLE;default:return c.sqG}}}return a.\u0275fac=function(l){return new(l||a)},a.\u0275cmp=o.Xpm({type:a,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[o.jDz],ngContentSelectors:_,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(l,g){1&l&&(o.F$t(),o.YNc(0,v,5,4,"div",0)),2&l&&o.Q6J("ngIf",g.showAlert)},dependencies:[n.O5,u.ot,u.RK,p.uH,p.BN],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]}),a})()}}]);